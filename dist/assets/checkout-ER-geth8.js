import{g as c,s as n,r as l,a as u,l as h}from"./utils-dBFMzG4w.js";import{E as m}from"./ExternalServices--z5BbAee.js";const p=new m;function d(i){const e=new FormData(i),t={};return e.forEach((o,s)=>{t[s]=o}),t}function g(i){return i.map(t=>(console.log(t),{id:t.Id,price:t.FinalPrice,name:t.Name,quantity:1}))}class x{constructor(e,t){this.key=e,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=c(this.key),this.calculateItemSummary()}calculateItemSummary(){const e=document.querySelector(this.outputSelector+" #cartTotal"),t=document.querySelector(this.outputSelector+" #num-items");t.innerText=this.list.length;const o=this.list.map(s=>s.FinalPrice);this.itemTotal=o.reduce((s,a)=>s+a),e.innerText=`$${this.itemTotal}`}calculateOrderTotal(){this.tax=this.itemTotal*.06,this.shipping=10+(this.list.length-1)*2,this.orderTotal=parseFloat(this.itemTotal)+parseFloat(this.tax)+parseFloat(this.shipping),this.displayOrderTotals()}displayOrderTotals(){const e=document.querySelector(`${this.outputSelector} #tax`),t=document.querySelector(`${this.outputSelector} #shipping`),o=document.querySelector(`${this.outputSelector} #orderTotal`);e.innerText=`$${this.tax.toFixed(2)}`,t.innerText=`$${this.shipping.toFixed(2)}`,o.innerText=`$${this.orderTotal.toFixed(2)}`}async checkout(){const e=document.forms.checkout,t=d(e);if(t.expiration){const o=t.expiration.replace(/[\s\-\/]/g,"");if(o.length===4&&/^\d{4}$/.test(o))t.expiration=o.slice(0,2)+"/"+o.slice(2);else if(/^\d{2}[\s\-]?\d{2}$/.test(t.expiration)){const s=t.expiration.match(/(\d{2})[\s\-]?(\d{2})/);s&&(t.expiration=s[1]+"/"+s[2])}}t.orderDate=new Date,t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=g(this.list),console.log(t);try{const o=await p.checkout(t);console.log(o),n("so-cart",[]),location.assign("/checkout/success.html")}catch(o){l();for(let s in o.message)u(o.message[s]);console.log(o)}}}h();const r=new x("so-cart",".checkout-summary");r.init();document.querySelector("#zip").addEventListener("blur",r.calculateOrderTotal.bind(r));const T=document.querySelector("#expiration");T.addEventListener("input",i=>{let e=i.target.value.replace(/\D/g,"");e.length>=2&&(e=e.slice(0,2)+"/"+e.slice(2,4)),i.target.value=e});document.querySelector("#checkoutSubmit").addEventListener("click",i=>{i.preventDefault(),r.checkout()});
